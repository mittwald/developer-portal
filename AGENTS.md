# Repository Guidelines

## Project Structure & Module Organization

- `docs/`: MDX content. Uses numeric prefixes for ordering (e.g., `40-how-to/1-become-contributor.mdx`) and `_category_.yml` for sidebars.
- `versioned_docs/`, `versioned_sidebars/`: Versioned API docs (v1) generated by scripts.
- `src/`: Docusaurus site code (React/TS). Key areas: `components/`, `pages/`, `theme/`, `openapi/`, `css/`.
- `generator/`: TypeScript generators for API reference, CLI docs, translations, and changelogs. See `overlays/`, `templates/`, `util/`.
- `static/`: Static assets and preview specs (`static/specs/`).
- `changelog/`, `i18n/`: Blog-style changelogs and translations.

## Build, Test, and Development Commands

- Prerequisites: Node ≥ 20; install deps with `npm ci`.
- `npm start`: Run local dev server (Docusaurus) with HMR.
- `npm run generate`: Generate API reference and sidebars; fetches OpenAPI specs; writes to `docs/reference` (v2), `versioned_docs/version-v1`, `src/openapi/openapi-*.json`, and `sidebar.*.json`.
- `npm run build`: Production build; fails on broken links/MDX (`onBrokenLinks/MarkdownLinks: throw`).
- `npm run serve`: Serve the `build/` output locally.
- `npm run format`: Format `docs i18n src` with Prettier.
- `npm run generate:changelog`: Generate changelog entries (requires OPENAI_API_KEY).
- `npm run generate:cli`: Generate CLI documentation from GitHub releases.
- `npm run generate:translations`: Generate translation files.
- `npm run write-heading-ids`: Write heading IDs for MDX files.
- `npm run write-translations`: Write translations for i18n.

## Testing Guidelines

- No unit test suite. Validate changes by building locally: `npm run generate && npm run build`.
- Fix any build errors for broken links, anchors (anchors are ignored in config), or MDX syntax.

## Code Style & Naming Conventions

### General

- Formatting: Prettier enforced (MD/MDX `printWidth: 80`, `proseWrap: preserve`). Run `npm run format` before committing.
- Languages: TypeScript/React
- Component naming: PascalCase for components (e.g., `MyComponent.tsx`, `FeatureRow.tsx`)
- Documentation files: kebab-case (e.g., `getting-started.mdx`)
- Generated files: Do not hand-edit outputs under `versioned_docs/`, `src/openapi/`, `docs/reference/`, or `sidebar.*.json`; use `npm run generate`.

### Imports

- Node built-ins first: `import * as path from "path";`
- External packages next: `import { OpenAPIV3 } from "openapi-types";`
- Internal packages with `@site/*` alias: `import { spec } from "@site/src/openapi/specs";`
- Relative imports for local modules: `import { applyOverlay } from "./util/overlay";`
- Prefer named exports over default exports for modules
- Use `React` explicitly when needed: `import React from "react";`

### TypeScript

- Strict mode enabled: `noImplicitAny: true`, `noUnusedParameters: true`, `noUnusedLocals: true`
- Use `type` for type aliases, `interface` for object shapes with potential extension
- Use `export type` for type-only exports
- Type assertions sparingly; prefer type guards: `if (schema.type === "array")`
- Use `any` only when absolutely necessary; prefer `unknown`

### React Components

- Functional components only (no class components)
- Props as interfaces: `interface Props { title: string; description: React.ReactNode; }`
- Destructure props: `function Feature({ title, description }: Props) { ... }`
- Use fragments: `<>...</>` instead of wrapping divs when not needed
- Keys for lists: use index or stable identifiers
- Import React explicitly: `import React from "react";`

### Error Handling

- Use try-catch for async operations that may fail
- Check file existence before reading: `if (fs.existsSync(path)) { ... }`
- Throw descriptive errors: `throw new Error("expected a directory");`
- Log errors in async IIFE: `(async () => { ... })().catch(console.error);`
- Return early for error conditions

### Generator/Scripts

- Use `tsx` for TypeScript execution
- Top-level functions: `async function generateDocs() { ... }`
- Self-executing async at bottom: `(async () => { await generateDocs(); })();`
- Use `console.log` for progress output
- File operations: use `fs/promises` for async, `fs` for sync

### CSS/Styling

- Import CSS modules: `import styles from "./styles.module.css";`
- Use CSS classes from modules: `className={styles.feature}`
- Use clsx for conditional classes: `clsx("col", "col--4")`
- CSS custom properties for theming in `src/css/custom.css`

## Commit & Pull Request Guidelines

- Use clear, imperative messages; Conventional Commits are welcome (e.g., `docs: improve varnish guide`, `fix: correct env var`, `chore(deps): bump …`).
- For PRs: include a concise summary, link related issues, and note any generator outputs updated. Ensure `npm run generate && npm run build` pass before submitting.

## Security & Configuration Tips

- Secrets: `OPENAI_API_KEY` is required only for changelog generation (`npm run generate:changelog`) and should not be committed. CI provides required secrets.
- Network access is required for `npm run generate` to fetch live OpenAPI specs and CLI documentation from GitHub.
